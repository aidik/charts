{{ $values := (. | mustDeepCopy) }}
{{ $_ := set $values "common" (dict "nameSuffix" "nginx") }}
{{ include "common.deployment.common_config" $values | nindent 0 }}
spec: {{ include "common.deployment.common_spec" $values | nindent 2 }}
  template: {{ include "common.deployment.pod.metadata" $values | nindent 4 }}
    spec:
      containers:
      - name: {{ .Chart.Name }}-nginx
        image: {{ printf "%s:%s" .Values.nginx.image.repository .Values.nginx.image.tag }}
        imagePullPolicy: {{ .Values.nginx.image.pullPolicy }}
        volumeMounts:
          - name: configuration
            mountPath: /etc/nginx/nginx.conf
            readOnly: true
            subPath: config
        ports:
        - name: http
          containerPort: 80
          protocol: TCP
        - name: https
          containerPort: 443
          protocol: TCP
      volumes:
        - name: configuration
        configMap:
          defaultMode: 0700
          name: "nginx-config"
